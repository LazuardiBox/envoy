#!/usr/bin/env bash
set -euo pipefail

SERVICE="envoy"
CONFIG="/etc/envoy/config/envoy.yaml"

usage() {
  cat <<EOF
Usage: $0 {start|stop|reload|status}

Commands:
  start   Start Envoy via systemd
  stop    Stop Envoy via systemd
  reload  Validate config and reload Envoy
  status  Show Envoy service status
EOF
  exit 1
}

validate() {
  echo "ðŸ” Validating Envoy config: $CONFIG"
  envoy --mode validate -c "$CONFIG"
}

case "${1:-}" in
  start)
    echo "â–¶ï¸  Starting Envoy"
    systemctl start "$SERVICE"
    ;;
  stop)
    echo "â¹  Stopping Envoy"
    systemctl stop "$SERVICE"
    ;;
  reload)
    validate
    echo "ðŸ” Reloading Envoy"
    systemctl reload "$SERVICE"
    ;;
  status)
    systemctl status "$SERVICE" --no-pager
    ;;
  *)
    usage
    ;;
esac
